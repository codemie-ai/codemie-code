# Run lint-staged (lint + test changed files)
npx lint-staged

# Check for secrets (only if Docker daemon is running)
if command -v docker >/dev/null 2>&1 && docker info >/dev/null 2>&1; then
  echo "ğŸ” Checking for secrets with Gitleaks..."
  npm run validate:secrets || {
    echo "âš ï¸  Secrets detected! Please remove sensitive data before committing."
    exit 1
  }
else
  # Docker not available - provide helpful hints based on installed alternatives
  if command -v colima >/dev/null 2>&1; then
    echo "âš ï¸  Docker daemon not running - Colima is installed"
    echo "ğŸ’¡ Run 'colima start' to enable secrets detection locally"
  elif command -v podman >/dev/null 2>&1; then
    echo "âš ï¸  Docker daemon not running - Podman is installed"
    echo "ğŸ’¡ Run 'podman machine start' to enable secrets detection locally"
  elif command -v orbstack >/dev/null 2>&1; then
    echo "âš ï¸  Docker daemon not running - OrbStack is installed"
    echo "ğŸ’¡ Start OrbStack to enable secrets detection locally"
  elif command -v docker >/dev/null 2>&1; then
    echo "âš ï¸  Docker installed but daemon not running"
    echo "ğŸ’¡ Start Docker Desktop to enable secrets detection locally"
  else
    echo "âš ï¸  Docker not available - skipping secrets detection (will run in CI)"
  fi
fi
